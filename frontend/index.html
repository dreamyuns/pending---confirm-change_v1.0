<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì•½í™•ì •ì²˜ë¦¬ ì‹œìŠ¤í…œ v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ìƒíƒœ íŒ¨ë„ */
        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }

        .status-waiting { background-color: #6c757d; }
        .status-running { 
            background-color: #ffc107; 
            animation: pulse 1.5s infinite;
        }
        .status-completed { background-color: #28a745; }
        .status-failed { background-color: #dc3545; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status-text {
            font-size: 1.2em;
            font-weight: bold;
        }

        /* ì„¤ì • íƒ­ */
        .config-tabs {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .tab-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .tab-button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tab-button.active {
            background: white;
            border-color: #667eea;
            color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* íƒ­ ì½˜í…ì¸  */
        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* ì„¤ì • í¼ */
        .config-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .config-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-start {
            background: #28a745;
            color: white;
        }

        .btn-start:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-stop {
            background: #dc3545;
            color: white;
        }

        .btn-stop:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-save {
            background: #007bff;
            color: white;
        }

        .btn-save:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            text-align: center;
            margin: 30px 0;
        }


        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-running { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-failed { background: #f8d7da; color: #721c24; }
        .status-stopped { background: #d1ecf1; color: #0c5460; }

        /* ì•Œë¦¼ */
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ì„¤ì • íƒ­ */
        .config-tabs {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: sticky;
            top: 120px;
            z-index: 99;
        }

        .tab-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            position: relative;
        }

        /* íƒ­ ì½˜í…ì¸  ìƒë‹¨ ì €ì¥ ë²„íŠ¼ */
        .tab-save-header {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tab-save-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #495057;
        }

        .btn-save-tab {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save-tab:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-1px);
        }

        .btn-save-tab:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .tab-button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tab-button.active {
            background: white;
            border-color: #667eea;
            color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* íƒ­ ì½˜í…ì¸  */
        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .config-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .config-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* ì‹¤í–‰ ì´ë ¥ í…Œì´ë¸” */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .history-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }

        .execution-status {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .execution-status h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-display {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .status-details {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .tab-header {
                flex-direction: column;
            }
            
            .tab-button {
                width: 100%;
                margin-bottom: 5px;
            }
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-btn-confirm {
            background: #28a745;
            color: white;
        }

        .modal-btn-confirm:hover {
            background: #218838;
        }

        .modal-btn-cancel {
            background: #6c757d;
            color: white;
        }

        .modal-btn-cancel:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âœ… ì˜ˆì•½í™•ì •ì²˜ë¦¬ ì‹œìŠ¤í…œ v2.0</h1>
        <p>ì›¹ ì¸í„°í˜ì´ìŠ¤ ì—°ë™ ë²„ì „ - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì„¤ì •í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”</p>
    </div>

    <div class="container">
        <!-- ìƒíƒœ íŒ¨ë„ -->
        <div class="status-panel">
            <span class="status-indicator status-waiting" id="statusIndicator"></span>
            <span class="status-text" id="statusText">ëŒ€ê¸° ì¤‘</span>
            <div id="statusDetails" style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;"></div>
        </div>


        <!-- ì„¤ì • íƒ­ -->
        <div class="config-tabs">
            <div class="tab-header">
                <button class="tab-button active" onclick="showTab('basic')">âš™ï¸ ê¸°ë³¸ì„¤ì •</button>
                <button class="tab-button" onclick="showTab('search')">ğŸ” ê²€ìƒ‰ì„¤ì •</button>
                <button class="tab-button" onclick="showTab('test')">ğŸ§ª í…ŒìŠ¤íŠ¸ëª¨ë“œì„¤ì •</button>
                <button class="tab-button" onclick="showTab('execution')">ğŸš€ í”„ë¡œì íŠ¸ì‹¤í–‰</button>
            </div>

            <!-- ê¸°ë³¸ì„¤ì • íƒ­ -->
            <div id="basic-tab" class="tab-content active">
                <div class="tab-save-header">
                    <div class="tab-save-title">âš™ï¸ ê¸°ë³¸ì„¤ì •</div>
                    <button class="btn-save-tab" id="saveTabBtn" onclick="saveCurrentTab()" disabled>ğŸ’¾ ì €ì¥</button>
                </div>
                <div class="config-section">
                    <h4>ğŸ” ë¡œê·¸ì¸ ì •ë³´</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>URL</label>
                            <input type="text" id="login-url" value="https://dev.allmytour.com:8443">
                        </div>
                        <div class="form-group">
                            <label>ì•„ì´ë””</label>
                            <input type="text" id="login-user-id" value="dreamyuns">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="login-password" value="0412">
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ“ íŒŒì¼ ê´€ë¦¬</h4>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                        <strong>ğŸ“‹ ì•ˆë‚´ì‚¬í•­:</strong><br>
                        â€¢ <strong>Excel íŒŒì¼:</strong> íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤<br>
                        â€¢ <strong>ë¡œê·¸ íŒŒì¼:</strong> ì‹¤í–‰ ì™„ë£Œ í›„ logs í´ë”ì— ìë™ ìƒì„±ë©ë‹ˆë‹¤<br>
                        â€¢ <strong>ê²°ê³¼ íŒŒì¼:</strong> ì‹¤í–‰ ì™„ë£Œ í›„ results í´ë”ì— ìë™ ìƒì„±ë©ë‹ˆë‹¤
                    </div>
                    
                    <!-- Excel íŒŒì¼ ì—…ë¡œë“œ -->
                    <div class="form-group">
                        <label for="excelUpload">Excel íŒŒì¼</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="file" id="excelUpload" accept=".xlsx,.xls,.csv" style="flex: 1; padding: 8px; border: 1px solid #ced4da; border-radius: 5px;">
                            <button type="button" class="btn btn-primary" onclick="uploadExcel()">ì—…ë¡œë“œ</button>
                        </div>
                        <div id="excelInfo" style="margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 5px; display: none;">
                            <!-- ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <div id="excelError" style="margin-top: 10px; color: #dc3545; display: none;">
                            <!-- ì—ëŸ¬ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>â±ï¸ í˜ì´ì§€ ì•ˆì •í™” ì‹œê°„ ì„¤ì •</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="page-load-wait">í˜ì´ì§€ ë¡œë”© ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="page-load-wait" min="1" max="10" step="0.5" value="2">
                        </div>
                        <div class="form-group">
                            <label for="detail-page-wait">ìƒì„¸í˜ì´ì§€ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="detail-page-wait" min="1" max="10" step="0.5" value="2">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="refresh-wait">í™”ë©´ ìƒˆë¡œê³ ì¹¨ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="refresh-wait" min="1" max="10" step="0.5" value="2">
                        </div>
                        <div class="form-group">
                            <label for="lms-popup-wait">LMS íŒì—… ëŒ€ê¸° ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="lms-popup-wait" min="1" max="10" step="0.5" value="2">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²€ìƒ‰ì„¤ì • íƒ­ -->
            <div id="search-tab" class="tab-content">
                <div class="tab-save-header">
                    <div class="tab-save-title">ğŸ” ê²€ìƒ‰ì„¤ì •</div>
                    <button class="btn-save-tab" id="saveTabBtn" onclick="saveCurrentTab()" disabled>ğŸ’¾ ì €ì¥</button>
                </div>
                <div class="config-section">
                    <h4>ğŸ“… ë‚ ì§œì„¤ì •</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì‹œì‘ ë‚ ì§œ</label>
                            <input type="date" id="start-date" value="2025-09-01">
                        </div>
                        <div class="form-group">
                            <label>ì¢…ë£Œ ë‚ ì§œ</label>
                            <input type="date" id="end-date" value="2025-09-30">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ë‚ ì§œ ìœ í˜•</label>
                        <select id="date-type">
                            <option value="">ì „ì²´</option>
                            <option value="orderDate" selected>orderdate(êµ¬ë§¤ì¼)</option>
                            <option value="useDate">usedate(ì´ìš©ì¼)</option>
                        </select>
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ” ì±„ë„ê²€ìƒ‰</h4>
                    <div class="form-group">
                        <label>ì±„ë„ëª… ë˜ëŠ” IDë¡œ ê²€ìƒ‰</label>
                        <input type="text" id="channel-search" placeholder="ì˜ˆ: ì˜¬ë§ˆì´íˆ¬ì–´, ìµìŠ¤í”¼ë””ì•„, 57" oninput="handleChannelSearch(this.value)">
                    </div>
                    <div class="form-group">
                        <label>ì±„ë„ ì„ íƒ</label>
                        <select id="channel-id">
                            <option value="" selected>ì „ì²´</option>
                            <option value="2">ì˜¬ë§ˆì´íˆ¬ì–´</option>
                        </select>
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ·ï¸ í•„í„°ì„¤ì •</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>íŒë§¤ ìœ í˜•</label>
                            <select id="sale-type">
                                <option value="">ì „ì²´</option>
                                <option value="b2c" selected>b2c</option>
                                <option value="b2b">b2b</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì˜ˆì•½ì¼ ìœ í˜•</label>
                            <select id="appoint-day-type">
                                <option value="">ì „ì²´</option>
                                <option value="selected">selected(ì§€ì •)</option>
                                <option value="nonselected">nonselected(ë¯¸ì§€ì •)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ë³€ê²½ ì „ ìƒíƒœ</label>
                        <select id="search-status">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>í˜ì´ì§€ë‹¹ ëª©ë¡ ê°œìˆ˜</label>
                        <input type="number" id="per-page" min="10" max="100" step="10" value="100">
                        <small style="color: #6c757d; display: block; margin-top: 5px;">ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ë‹¹ í‘œì‹œí•  ì£¼ë¬¸ ê°œìˆ˜ (10~100)</small>
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ”„ ë³€ê²½í•  ìƒíƒœ ì„¤ì •</h4>
                    <div class="form-group">
                        <label>ë³€ê²½í•  ìƒíƒœ</label>
                        <select id="change-status">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </select>
                    </div>
                </div>
            </div>

            <!-- í…ŒìŠ¤íŠ¸ëª¨ë“œì„¤ì • íƒ­ -->
            <div id="test-tab" class="tab-content">
                <div class="tab-save-header">
                    <div class="tab-save-title">ğŸ§ª í…ŒìŠ¤íŠ¸ëª¨ë“œì„¤ì •</div>
                    <button class="btn-save-tab" id="saveTabBtn" onclick="saveCurrentTab()" disabled>ğŸ’¾ ì €ì¥</button>
                </div>
                <div class="config-section">
                    <h4>ğŸ§ª í…ŒìŠ¤íŠ¸ëª¨ë“œ ì„¤ì •</h4>
                    <div class="form-group">
                        <label>í…ŒìŠ¤íŠ¸ ëª¨ë“œ</label>
                        <select id="test-mode">
                            <option value="false" selected>ë¹„í™œì„±í™”</option>
                            <option value="true">í™œì„±í™”</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>í…ŒìŠ¤íŠ¸ ì‹œì‘ í–‰</label>
                            <input type="number" id="test-start" value="4" min="4">
                        </div>
                        <div class="form-group">
                            <label>í…ŒìŠ¤íŠ¸ ì¢…ë£Œ í–‰</label>
                            <input type="number" id="test-end" value="7" min="4">
                        </div>
                    </div>
                </div>
            </div>

            <!-- í”„ë¡œì íŠ¸ì‹¤í–‰ íƒ­ -->
            <div id="execution-tab" class="tab-content">
                <div class="tab-save-header">
                    <div class="tab-save-title">ğŸš€ í”„ë¡œì íŠ¸ì‹¤í–‰</div>
                    <button class="btn-save-tab" id="saveTabBtn" onclick="saveCurrentTab()" disabled style="display: none;">ğŸ’¾ ì €ì¥</button>
                </div>
                <div class="config-section">
                    <h4>ğŸš€ í”„ë¡œì íŠ¸ ì‹¤í–‰</h4>
                    <div class="action-buttons">
                        <button class="btn btn-start" id="startBtn" onclick="startProject()">ğŸš€ ì‹œì‘</button>
                        <button class="btn btn-stop" id="stopBtn" onclick="stopProject()" disabled>â¹ï¸ ì¤‘ë‹¨</button>
                    </div>
                    
                    <div class="execution-status">
                        <h4>ì‹¤í–‰ ìƒíƒœ</h4>
                        <div class="status-display">
                            <span class="status-indicator status-waiting" id="statusIndicator"></span>
                            <span class="status-text" id="statusText">ëŒ€ê¸° ì¤‘</span>
                        </div>
                        <div id="statusDetails" class="status-details"></div>
                    </div>
                </div>

                <!-- ì‹¤í–‰ ì´ë ¥ -->
                <div class="config-section">
                    <h4>ğŸ“Š ì‹¤í–‰ ì´ë ¥</h4>
                    <table class="history-table" id="historyTable">
                        <thead>
                            <tr>
                                <th>ì‹¤í–‰ ì‹œê°„</th>
                                <th>ìƒíƒœ</th>
                                <th>ì‹¤í–‰ ì‹œê°„</th>
                                <th>ë°˜í™˜ ì½”ë“œ</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <tr>
                                <td colspan="4" style="text-align: center; color: #6c757d;">ì‹¤í–‰ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


    <!-- í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">í™•ì¸</h3>
            <p id="modalMessage">ì •ë§ë¡œ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="modalConfirm">í™•ì¸</button>
                <button class="modal-btn modal-btn-cancel" id="modalCancel">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        let currentStatus = 'waiting';
        let statusPolling = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            loadHistory();
            loadCommonData(); // ê³µí†µ ë°ì´í„° ë¡œë“œ ì¶”ê°€
            
            // ë³€ê²½ ê°ì§€ ì„¤ì •
            setTimeout(() => {
                saveOriginalValues();
                setupChangeDetection();
                setupAutoSave(); // localStorage ìë™ ì €ì¥ ì„¤ì •
                updateSaveButtonState();
            }, 1000); // ì„¤ì • ë¡œë“œ í›„ ì‹¤í–‰
        });

        // ì „ì—­ ë³€ìˆ˜
        let currentTab = 'basic';
        let originalValues = {};
        let hasChanges = false;

        // localStorageì— ì„¤ì • ì €ì¥
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem('admin_confirm_' + key, value);
            } catch (error) {
                console.error('localStorage ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        // localStorageì—ì„œ ì„¤ì • ë¡œë“œ
        function loadFromLocalStorage(key) {
            try {
                return localStorage.getItem('admin_confirm_' + key);
            } catch (error) {
                console.error('localStorage ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }
        
        // ì…ë ¥ í•„ë“œì— ìë™ ì €ì¥ ì´ë²¤íŠ¸ ì¶”ê°€
        function setupAutoSave() {
            // ì €ì¥í•  í•„ë“œ ëª©ë¡ (ë¹„ë°€ë²ˆí˜¸ ì œì™¸)
            const fieldsToSave = [
                'login-url', 'login-user-id',
                'page-load-wait', 'detail-page-wait', 'refresh-wait', 'lms-popup-wait',
                'start-date', 'end-date', 'date-type', 'channel-id',
                'sale-type', 'appoint-day-type', 'search-status', 'per-page', 'change-status',
                'test-mode', 'test-start', 'test-end'
            ];
            
            fieldsToSave.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.addEventListener('change', function() {
                        saveToLocalStorage(fieldId, this.value);
                    });
                }
            });
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // í˜„ì¬ íƒ­ ì—…ë°ì´íŠ¸
            currentTab = tabName;
            
            // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSaveButtonState();
        }

        // í˜„ì¬ íƒ­ ì €ì¥
        async function saveCurrentTab() {
            switch(currentTab) {
                case 'basic':
                    await saveBasicConfig();
                    break;
                case 'search':
                    await saveSearchConfig();
                    break;
                case 'test':
                    await saveTestConfig();
                    break;
                case 'execution':
                    // ì‹¤í–‰ íƒ­ì€ ì €ì¥ ê¸°ëŠ¥ ì—†ìŒ
                    showNotification('í”„ë¡œì íŠ¸ì‹¤í–‰ íƒ­ì—ëŠ” ì €ì¥í•  ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    break;
            }
        }

        // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSaveButtonState() {
            // ëª¨ë“  íƒ­ì˜ ì €ì¥ ë²„íŠ¼ì„ ì°¾ì•„ì„œ ì²˜ë¦¬
            const allSaveBtns = document.querySelectorAll('.btn-save-tab');
            
            allSaveBtns.forEach(saveBtn => {
                const tabContent = saveBtn.closest('.tab-content');
                const isActiveTab = tabContent.classList.contains('active');
                
                if (isActiveTab) {
                    if (currentTab === 'execution') {
                        saveBtn.style.display = 'none';
                    } else {
                        saveBtn.style.display = 'inline-block';
                        // ë³€ê²½ì‚¬í•­ í™•ì¸
                        checkForChanges();
                        saveBtn.disabled = !hasChanges;
                    }
                } else {
                    saveBtn.style.display = 'none';
                }
            });
        }

        // ë³€ê²½ì‚¬í•­ í™•ì¸
        function checkForChanges() {
            hasChanges = false;
            
            // í˜„ì¬ íƒ­ì˜ ëª¨ë“  ì…ë ¥ ìš”ì†Œ í™•ì¸
            const currentTabElement = document.getElementById(currentTab + '-tab');
            const inputs = currentTabElement.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                const currentValue = input.value;
                const originalValue = originalValues[input.id] || '';
                
                if (currentValue !== originalValue) {
                    hasChanges = true;
                }
            });
        }

        // ì›ë³¸ ê°’ ì €ì¥
        function saveOriginalValues() {
            originalValues = {};
            
            // ëª¨ë“  íƒ­ì˜ ì…ë ¥ ìš”ì†Œ ê°’ ì €ì¥
            document.querySelectorAll('.tab-content input, .tab-content select, .tab-content textarea').forEach(input => {
                originalValues[input.id] = input.value;
            });
        }

        // ì…ë ¥ ë³€ê²½ ê°ì§€
        function setupChangeDetection() {
            document.querySelectorAll('.tab-content input, .tab-content select, .tab-content textarea').forEach(input => {
                input.addEventListener('input', function() {
                    checkForChanges();
                    updateSaveButtonState();
                });
                
                input.addEventListener('change', function() {
                    checkForChanges();
                    updateSaveButtonState();
                });
            });
        }

        // ëª¨ë‹¬ í‘œì‹œ
        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('confirmModal').style.display = 'block';
            
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            const confirmBtn = document.getElementById('modalConfirm');
            const cancelBtn = document.getElementById('modalCancel');
            
            confirmBtn.onclick = null;
            cancelBtn.onclick = null;
            
            // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            confirmBtn.onclick = function() {
                document.getElementById('confirmModal').style.display = 'none';
                if (onConfirm) onConfirm();
            };
            
            cancelBtn.onclick = function() {
                document.getElementById('confirmModal').style.display = 'none';
            };
        }

        // ëª¨ë‹¬ ë‹«ê¸° (ë°°ê²½ í´ë¦­ ì‹œ)
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // ì„¤ì • ë¡œë“œ
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const result = await response.json();
                
                if (result.success) {
                    const config = result.config;
                    populateForm(config);
                    console.log('ì„¤ì • ë¡œë“œ ì™„ë£Œ');
                } else {
                    showNotification('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification('ì„¤ì • ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // í¼ì— ì„¤ì • ê°’ ì±„ìš°ê¸° (localStorage ìš°ì„ )
        function populateForm(config) {
            // ê¸°ë³¸ ì„¤ì • - localStorage ìš°ì„ , ì—†ìœ¼ë©´ ì„œë²„ ì„¤ì • ì‚¬ìš©
            document.getElementById('login-url').value = loadFromLocalStorage('login-url') || config.login?.url || 'https://dev.allmytour.com:8443';
            document.getElementById('login-user-id').value = loadFromLocalStorage('login-user-id') || config.login?.user_id || '';
            document.getElementById('login-password').value = config.login?.password || '';  // ë¹„ë°€ë²ˆí˜¸ëŠ” localStorage ì‚¬ìš© ì•ˆ í•¨
            
            // í˜ì´ì§€ ì•ˆì •í™” ì‹œê°„ ì„¤ì • - localStorage ìš°ì„ 
            document.getElementById('page-load-wait').value = loadFromLocalStorage('page-load-wait') || config.timing?.page_load_wait || 2;
            document.getElementById('detail-page-wait').value = loadFromLocalStorage('detail-page-wait') || config.timing?.detail_page_wait || 2;
            document.getElementById('refresh-wait').value = loadFromLocalStorage('refresh-wait') || config.timing?.refresh_wait || 2;
            document.getElementById('lms-popup-wait').value = loadFromLocalStorage('lms-popup-wait') || config.timing?.lms_popup_wait || 2;
            
            // ê²€ìƒ‰ ì„¤ì • - localStorage ìš°ì„ 
            if (config.search_settings) {
                document.getElementById('start-date').value = loadFromLocalStorage('start-date') || config.search_settings.startDate || '2025-09-01';
                document.getElementById('end-date').value = loadFromLocalStorage('end-date') || config.search_settings.endDate || '2025-09-30';
                document.getElementById('date-type').value = loadFromLocalStorage('date-type') || config.search_settings.dateType || 'orderDate';
                document.getElementById('channel-id').value = loadFromLocalStorage('channel-id') || config.search_settings.orderChannelIdx || '';
                document.getElementById('sale-type').value = loadFromLocalStorage('sale-type') || config.search_settings.saleType || 'b2c';
                document.getElementById('appoint-day-type').value = loadFromLocalStorage('appoint-day-type') || config.search_settings.appoint_day_type || '';
                // ë³€ê²½ ì „ ìƒíƒœ (í•˜ìœ„ í˜¸í™˜ì„±: change_status ì§€ì›)
                const searchStatus = loadFromLocalStorage('search-status') || config.search_settings.search_status || config.search_settings.change_status || 'pending';
                document.getElementById('search-status').value = searchStatus;
                // í˜ì´ì§€ë‹¹ ëª©ë¡ ê°œìˆ˜
                document.getElementById('per-page').value = loadFromLocalStorage('per-page') || config.search_settings.per_page || 100;
                // ë³€ê²½í•  ìƒíƒœ
                document.getElementById('change-status').value = loadFromLocalStorage('change-status') || config.status_change?.change_to_status || 'confirm';
            }
            
            // Excel ì„¤ì • - localStorage ìš°ì„ 
            if (config.excel_settings && config.excel_settings.test_mode) {
                document.getElementById('test-mode').value = loadFromLocalStorage('test-mode') || (config.excel_settings.test_mode.enabled ? 'true' : 'false');
                document.getElementById('test-start').value = loadFromLocalStorage('test-start') || config.excel_settings.test_mode.start_row || 4;
                document.getElementById('test-end').value = loadFromLocalStorage('test-end') || config.excel_settings.test_mode.end_row || 7;
            }
        }

        // ê¸°ë³¸ì„¤ì • ì €ì¥ (í†µí•©)
        async function saveBasicConfig() {
            const configData = {
                login: {
                    url: document.getElementById('login-url').value,
                    user_id: document.getElementById('login-user-id').value,
                    password: document.getElementById('login-password').value
                },
                timing: {
                    page_load_wait: parseFloat(document.getElementById('page-load-wait').value) || 2,
                    detail_page_wait: parseFloat(document.getElementById('detail-page-wait').value) || 2,
                    refresh_wait: parseFloat(document.getElementById('refresh-wait').value) || 2,
                    lms_popup_wait: parseFloat(document.getElementById('lms-popup-wait').value) || 2
                }
            };
            
            await saveConfig(configData, 'âš™ï¸ ê¸°ë³¸ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }


        // ê²€ìƒ‰ì„¤ì • ì €ì¥ (í†µí•©)
        async function saveSearchConfig() {
            const configData = {
                search_settings: {
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    dateType: document.getElementById('date-type').value,
                    orderChannelIdx: document.getElementById('channel-id').value,
                    saleType: document.getElementById('sale-type').value,
                    appoint_day_type: document.getElementById('appoint-day-type').value,
                    search_status: document.getElementById('search-status').value,
                    per_page: parseInt(document.getElementById('per-page').value) || 100
                },
                status_change: {
                    change_to_status: document.getElementById('change-status').value
                }
            };
            
            await saveConfig(configData, 'ğŸ” ê²€ìƒ‰ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // í…ŒìŠ¤íŠ¸ëª¨ë“œ ì„¤ì • ì €ì¥
        async function saveTestConfig() {
            const configData = {
                excel_settings: {
                    test_mode: {
                        enabled: document.getElementById('test-mode').value === 'true',
                        start_row: parseInt(document.getElementById('test-start').value),
                        end_row: parseInt(document.getElementById('test-end').value)
                    }
                }
            };
            
            await saveConfig(configData, 'ğŸ§ª í…ŒìŠ¤íŠ¸ëª¨ë“œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì„¤ì • ì €ì¥ ê³µí†µ í•¨ìˆ˜
        async function saveConfig(configData, message) {
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(configData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(message, 'success');
                    
                    // ì €ì¥ ì„±ê³µ í›„ localStorageì—ë„ ì €ì¥ (ë¹„ë°€ë²ˆí˜¸ ì œì™¸)
                    const fieldsToSave = {
                        'basic': ['login-url', 'login-user-id', 'page-load-wait', 'detail-page-wait', 'refresh-wait', 'lms-popup-wait'],
                        'search': ['start-date', 'end-date', 'date-type', 'channel-id', 'sale-type', 'appoint-day-type', 'search-status', 'per-page', 'change-status'],
                        'test': ['test-mode', 'test-start', 'test-end']
                    };
                    
                    const currentTabFields = fieldsToSave[currentTab] || [];
                    currentTabFields.forEach(fieldId => {
                        const element = document.getElementById(fieldId);
                        if (element) {
                            saveToLocalStorage(fieldId, element.value);
                        }
                    });
                    
                    // ì €ì¥ ì„±ê³µ í›„ ì›ë³¸ ê°’ ì—…ë°ì´íŠ¸
                    saveOriginalValues();
                    updateSaveButtonState();
                } else {
                    showNotification('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('ì„¤ì • ì €ì¥ ì˜¤ë¥˜:', error);
                showNotification('ì„¤ì • ì €ì¥ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // í”„ë¡œì íŠ¸ ì‹œì‘
        async function startProject() {
            if (currentStatus === 'running') {
                showNotification('ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.', 'warning');
                return;
            }

            showConfirmModal(
                'í”„ë¡œì íŠ¸ ì‹¤í–‰ í™•ì¸',
                'ì˜ˆì•½í™•ì •ì²˜ë¦¬ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                async function() {
                    try {
                        // í˜„ì¬ ì„¤ì • ìˆ˜ì§‘
                        const configData = {
                            search_settings: {
                                startDate: document.getElementById('start-date').value,
                                endDate: document.getElementById('end-date').value,
                                dateType: document.getElementById('date-type').value,
                                orderChannelIdx: document.getElementById('channel-id').value,
                                saleType: document.getElementById('sale-type').value,
                                appoint_day_type: document.getElementById('appoint-day-type').value,
                                search_status: document.getElementById('search-status').value,
                                per_page: parseInt(document.getElementById('per-page').value) || 100
                            },
                            status_change: {
                                change_to_status: document.getElementById('change-status').value
                            },
                            timing: {
                                page_load_wait: parseFloat(document.getElementById('page-load-wait').value) || 2,
                                detail_page_wait: parseFloat(document.getElementById('detail-page-wait').value) || 2,
                                refresh_wait: parseFloat(document.getElementById('refresh-wait').value) || 2,
                                lms_popup_wait: parseFloat(document.getElementById('lms-popup-wait').value) || 2
                            },
                            excel_settings: {
                                test_mode: {
                                    enabled: document.getElementById('test-mode').value === 'true',
                                    start_row: parseInt(document.getElementById('test-start').value),
                                    end_row: parseInt(document.getElementById('test-end').value)
                                }
                            }
                        };

                        const response = await fetch('/api/start', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(configData)
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            currentStatus = 'running';
                            updateStatus('running', 'ì‹¤í–‰ ì¤‘...');
                            document.getElementById('startBtn').disabled = true;
                            document.getElementById('stopBtn').disabled = false;
                            showNotification(result.message, 'success');
                            
                            // ìƒíƒœ í´ë§ ì‹œì‘
                            startStatusPolling();
                        } else {
                            showNotification('í”„ë¡œì íŠ¸ ì‹œì‘ ì‹¤íŒ¨: ' + result.error, 'error');
                        }
                    } catch (error) {
                        console.error('í”„ë¡œì íŠ¸ ì‹œì‘ ì˜¤ë¥˜:', error);
                        showNotification('í”„ë¡œì íŠ¸ ì‹œì‘ ì˜¤ë¥˜: ' + error.message, 'error');
                    }
                }
            );
        }

        // í”„ë¡œì íŠ¸ ì¤‘ë‹¨
        async function stopProject() {
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ force: false })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentStatus = 'stopped';
                    updateStatus('stopped', 'ì¤‘ë‹¨ë¨');
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    showNotification(result.message, 'warning');
                    
                    // ìƒíƒœ í´ë§ ì¤‘ë‹¨
                    stopStatusPolling();
                    
                    // ì‹¤í–‰ ì´ë ¥ ìƒˆë¡œê³ ì¹¨
                    loadHistory();
                } else {
                    showNotification('í”„ë¡œì íŠ¸ ì¤‘ë‹¨ ì‹¤íŒ¨: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('í”„ë¡œì íŠ¸ ì¤‘ë‹¨ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ìƒíƒœ í´ë§ ì‹œì‘
        function startStatusPolling() {
            statusPolling = setInterval(async () => {
                try {
                    const response = await fetch('/api/status');
                    const result = await response.json();
                    
                    if (result.success) {
                        // statusê°€ Noneì¸ ê²½ìš° (í”„ë¡œì íŠ¸ê°€ ì—†ê±°ë‚˜ ì™„ì „íˆ ì¢…ë£Œë¨)
                        if (!result.status) {
                            // í˜„ì¬ ìƒíƒœê°€ runningì´ì—ˆë‹¤ë©´ ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½
                            if (currentStatus === 'running') {
                                currentStatus = 'waiting';
                                updateStatus('waiting', 'ëŒ€ê¸° ì¤‘');
                                document.getElementById('startBtn').disabled = false;
                                document.getElementById('stopBtn').disabled = true;
                                stopStatusPolling();
                                loadHistory();
                            }
                            return;
                        }
                        
                        const status = result.status;
                        
                        if (status.status === 'running') {
                            updateStatus('running', 'ì‹¤í–‰ ì¤‘...', `ì‹¤í–‰ ì‹œê°„: ${status.duration}`);
                        } else if (status.status === 'completed') {
                            currentStatus = 'completed';
                            updateStatus('completed', 'ì™„ë£Œ', `ì‹¤í–‰ ì‹œê°„: ${status.duration}`);
                            document.getElementById('startBtn').disabled = false;
                            document.getElementById('stopBtn').disabled = true;
                            stopStatusPolling();
                            loadHistory();
                            showNotification('í”„ë¡œì íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                        } else if (status.status === 'failed') {
                            currentStatus = 'failed';
                            updateStatus('failed', 'ì‹¤íŒ¨', `ì˜¤ë¥˜ ì½”ë“œ: ${status.return_code}`);
                            document.getElementById('startBtn').disabled = false;
                            document.getElementById('stopBtn').disabled = true;
                            stopStatusPolling();
                            loadHistory();
                            showNotification('í”„ë¡œì íŠ¸ ì‹¤í–‰ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                        } else if (status.status === 'stopped') {
                            currentStatus = 'stopped';
                            updateStatus('stopped', 'ì¤‘ë‹¨ë¨', status.duration ? `ì‹¤í–‰ ì‹œê°„: ${status.duration}` : '');
                            document.getElementById('startBtn').disabled = false;
                            document.getElementById('stopBtn').disabled = true;
                            stopStatusPolling();
                            loadHistory();
                            showNotification('í”„ë¡œì íŠ¸ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
                        }
                    }
                } catch (error) {
                    console.error('ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                }
            }, 2000); // 2ì´ˆë§ˆë‹¤ í™•ì¸
        }

        // ìƒíƒœ í´ë§ ì¤‘ë‹¨
        function stopStatusPolling() {
            if (statusPolling) {
                clearInterval(statusPolling);
                statusPolling = null;
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(status, text, details = '') {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const statusDetails = document.getElementById('statusDetails');
            
            // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
            indicator.className = 'status-indicator';
            
            // ìƒˆ ìƒíƒœ ì ìš©
            indicator.classList.add('status-' + status);
            statusText.textContent = text;
            statusDetails.textContent = details;
        }

        // ì‹¤í–‰ ì´ë ¥ ë¡œë“œ
        async function loadHistory() {
            try {
                const response = await fetch('/api/history?limit=10');
                const result = await response.json();
                
                if (result.success) {
                    const historyBody = document.getElementById('historyBody');
                    
                    if (result.history.length === 0) {
                        historyBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #6c757d;">ì‹¤í–‰ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                    } else {
                        historyBody.innerHTML = result.history.map(item => {
                            const startTime = new Date(item.start_time).toLocaleString();
                            const duration = item.duration || '-';
                            const returnCode = item.return_code !== undefined ? item.return_code : '-';
                            
                            return `
                                <tr>
                                    <td>${startTime}</td>
                                    <td><span class="status-badge status-${item.status}">${item.status}</span></td>
                                    <td>${duration}</td>
                                    <td>${returnCode}</td>
                                </tr>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.error('ì´ë ¥ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ===== ê³µí†µ ë°ì´í„° ë¡œë”© í•¨ìˆ˜ë“¤ =====

        // ===== íŒŒì¼ ì—…ë¡œë“œ í•¨ìˆ˜ë“¤ =====
        
        // Excel íŒŒì¼ ì—…ë¡œë“œ
        async function uploadExcel() {
            const fileInput = document.getElementById('excelUpload');
            const file = fileInput.files[0];
            const errorDiv = document.getElementById('excelError');
            const infoDiv = document.getElementById('excelInfo');
            
            // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            errorDiv.style.display = 'none';
            infoDiv.style.display = 'none';
            
            if (!file) {
                showNotification('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch('/api/upload-excel', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    infoDiv.innerHTML = `
                        <div style="color: #28a745; font-weight: bold;">âœ… ì—…ë¡œë“œ ì™„ë£Œ</div>
                        <div style="margin-top: 5px;">
                            <strong>íŒŒì¼ëª…:</strong> ${result.filename}<br>
                            <strong>í¬ê¸°:</strong> ${(result.file_size / 1024).toFixed(1)} KB<br>
                            <strong>ì—…ë¡œë“œ ì‹œê°„:</strong> ${new Date(result.upload_time).toLocaleString()}
                        </div>
                    `;
                    infoDiv.style.display = 'block';
                    
                    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                    fileInput.value = '';
                    
                    showNotification('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // ì„¤ì • ìë™ ì €ì¥ì„ ìœ„í•´ ì„¤ì • ë‹¤ì‹œ ë¡œë“œ
                    await loadConfig();
                } else {
                    errorDiv.textContent = result.error;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }
        
        // ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ ë¡œë“œ
        async function loadUploadedFiles() {
            try {
                const response = await fetch('/api/uploaded-files');
                const result = await response.json();
                
                if (result.success && result.files.length > 0) {
                    const file = result.files[0]; // Excel íŒŒì¼
                    const infoDiv = document.getElementById('excelInfo');
                    infoDiv.innerHTML = `
                        <div style="color: #28a745; font-weight: bold;">âœ… ì—…ë¡œë“œëœ íŒŒì¼</div>
                        <div style="margin-top: 5px;">
                            <strong>íŒŒì¼ëª…:</strong> ${file.filename}<br>
                            <strong>í¬ê¸°:</strong> ${(file.file_size / 1024).toFixed(1)} KB<br>
                            <strong>ì—…ë¡œë“œ ì‹œê°„:</strong> ${new Date(file.upload_time).toLocaleString()}
                        </div>
                    `;
                    infoDiv.style.display = 'block';
                }
            } catch (error) {
                console.log('ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ê³µí†µ ë°ì´í„° ë¡œë“œ
        async function loadCommonData() {
            try {
                await Promise.all([
                    loadChannels(),
                    loadSaleTypes(),
                    loadDateTypes(),
                    loadAppointDayTypes(),
                    loadSearchStatuses(),
                    loadChangeStatuses(),
                    loadUploadedFiles() // ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ ë¡œë“œ
                ]);
                console.log('ê³µí†µ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('ê³µí†µ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showAlert('ê³µí†µ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'danger');
            }
        }

        // ì±„ë„ ë°ì´í„° ë¡œë“œ
        async function loadChannels() {
            try {
                const response = await fetch('/api/channels');
                const result = await response.json();
                
                if (result.success) {
                    const channelSelect = document.getElementById('channel-id');
                    channelSelect.innerHTML = '<option value="">ì „ì²´</option>';
                    
                    result.channels.forEach(channel => {
                        const option = document.createElement('option');
                        option.value = channel.id;
                        option.textContent = channel.display;
                        channelSelect.appendChild(option);
                    });
                    
                    console.log('ì±„ë„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', result.channels.length + 'ê°œ');
                } else {
                    console.error('ì±„ë„ ë¡œë“œ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('ì±„ë„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // íŒë§¤ ìœ í˜• ë°ì´í„° ë¡œë“œ
        async function loadSaleTypes() {
            try {
                const response = await fetch('/api/sale-types');
                const result = await response.json();
                
                if (result.success) {
                    const saleTypeSelect = document.getElementById('sale-type');
                    saleTypeSelect.innerHTML = '<option value="">ì „ì²´</option>';
                    
                    result.sale_types.forEach(saleType => {
                        const option = document.createElement('option');
                        option.value = saleType.code;
                        option.textContent = saleType.display;
                        saleTypeSelect.appendChild(option);
                    });
                    
                    console.log('íŒë§¤ ìœ í˜• ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', result.sale_types.length + 'ê°œ');
                } else {
                    console.error('íŒë§¤ ìœ í˜• ë¡œë“œ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('íŒë§¤ ìœ í˜• ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë‚ ì§œ ìœ í˜• ë°ì´í„° ë¡œë“œ
        async function loadDateTypes() {
            try {
                const response = await fetch('/api/date-types');
                const result = await response.json();
                
                if (result.success) {
                    const dateTypeSelect = document.getElementById('date-type');
                    dateTypeSelect.innerHTML = '<option value="">ì „ì²´</option>';
                    
                    result.date_types.forEach(dateType => {
                        const option = document.createElement('option');
                        option.value = dateType.code;
                        option.textContent = dateType.display;
                        dateTypeSelect.appendChild(option);
                    });
                    
                    console.log('ë‚ ì§œ ìœ í˜• ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', result.date_types.length + 'ê°œ');
                } else {
                    console.error('ë‚ ì§œ ìœ í˜• ë¡œë“œ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('ë‚ ì§œ ìœ í˜• ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì˜ˆì•½ì¼ ìœ í˜• ë°ì´í„° ë¡œë“œ
        async function loadAppointDayTypes() {
            try {
                const response = await fetch('/api/appoint-day-types');
                const result = await response.json();
                
                if (result.success) {
                    const appointDaySelect = document.getElementById('appoint-day-type');
                    appointDaySelect.innerHTML = '<option value="">ì „ì²´</option>';
                    
                    result.appoint_types.forEach(appointType => {
                        const option = document.createElement('option');
                        option.value = appointType.code;
                        option.textContent = appointType.display;
                        appointDaySelect.appendChild(option);
                    });
                    
                    console.log('ì˜ˆì•½ì¼ ìœ í˜• ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', result.appoint_types.length + 'ê°œ');
                } else {
                    console.error('ì˜ˆì•½ì¼ ìœ í˜• ë¡œë“œ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('ì˜ˆì•½ì¼ ìœ í˜• ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë³€ê²½ ì „ ìƒíƒœ ë°ì´í„° ë¡œë“œ (ê²€ìƒ‰ ì¡°ê±´ìš©)
        async function loadSearchStatuses() {
            try {
                const response = await fetch('/api/search-statuses');
                const result = await response.json();
                
                if (result.success) {
                    const searchStatusSelect = document.getElementById('search-status');
                    searchStatusSelect.innerHTML = '';
                    
                    result.search_statuses.forEach(status => {
                        const option = document.createElement('option');
                        option.value = status.code;
                        option.textContent = status.display;
                        // pending(ëŒ€ê¸°)ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                        if (status.code === 'pending') {
                            option.selected = true;
                        }
                        searchStatusSelect.appendChild(option);
                    });
                    
                    console.log('ë³€ê²½ ì „ ìƒíƒœ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', result.search_statuses.length + 'ê°œ');
                } else {
                    console.error('ë³€ê²½ ì „ ìƒíƒœ ë¡œë“œ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('ë³€ê²½ ì „ ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ë³€ê²½í•  ìƒíƒœ ë°ì´í„° ë¡œë“œ
        async function loadChangeStatuses() {
            try {
                const response = await fetch('/api/change-statuses');
                const result = await response.json();
                
                if (result.success) {
                    const changeStatusSelect = document.getElementById('change-status');
                    changeStatusSelect.innerHTML = '';
                    
                    result.change_statuses.forEach(status => {
                        const option = document.createElement('option');
                        option.value = status.code;
                        option.textContent = status.display;
                        // confirm(í™•ì •)ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                        if (status.code === 'confirm') {
                            option.selected = true;
                        }
                        changeStatusSelect.appendChild(option);
                    });
                    
                    console.log('ë³€ê²½í•  ìƒíƒœ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', result.change_statuses.length + 'ê°œ');
                } else {
                    console.error('ë³€ê²½í•  ìƒíƒœ ë¡œë“œ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('ë³€ê²½í•  ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì±„ë„ ê²€ìƒ‰ ê¸°ëŠ¥
        async function searchChannels(query) {
            try {
                const response = await fetch(`/api/channels/search?q=${encodeURIComponent(query)}`);
                const result = await response.json();
                
                if (result.success) {
                    const channelSelect = document.getElementById('channel-id');
                    channelSelect.innerHTML = '<option value="">ì „ì²´</option>';
                    
                    result.channels.forEach(channel => {
                        const option = document.createElement('option');
                        option.value = channel.id;
                        option.textContent = channel.display;
                        channelSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('ì±„ë„ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            }
        }

        // ì±„ë„ ê²€ìƒ‰ í•¸ë“¤ëŸ¬
        function handleChannelSearch(query) {
            if (query.trim() === '') {
                // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´ ì±„ë„ ë¡œë“œ
                loadChannels();
            } else {
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ ì‹¤í–‰
                searchChannels(query);
            }
        }

        // ì•Œë¦¼ í‘œì‹œ (showNotificationìœ¼ë¡œ í†µì¼)
        function showNotification(message, type) {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // ìƒˆ ì•Œë¦¼ ìƒì„±
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            // ì»¨í…Œì´ë„ˆ ìƒë‹¨ì— ì¶”ê°€
            const container = document.querySelector('.container');
            container.insertBefore(alert, container.firstChild);
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
